/**
 * Loading assets with progress bar
 * @author 5dbwat4 <me@5dbwat4.top>
 */(()=>{var a=[];document.querySelectorAll("[progressing]").forEach(e=>{if(e.tagName=="SCRIPT"){let t=e.getAttribute("data-src");a.push({url:t,dom:e,type:"text/javascript"}),document.querySelector(".progressing").insertAdjacentHTML("beforeend",`<div class="loading-item"><p>${t.split("/").pop()}</p><div class="progress-bar-rail"><div class="progress-bar-fill" id="progress-bar-${t}"></div></div><p id="percentage-${t}"></p><p id="speed-${t}"></p></div>`)}if(e.tagName=="LINK"&&e.getAttribute("rel")=="stylesheet"){let t=e.getAttribute("data-href");a.push({url:t,dom:e,type:"text/css"}),document.querySelector(".progressing").insertAdjacentHTML("beforeend",`<div class="loading-item"><p>${t.split("/").pop()}</p><div class="progress-bar-rail"><div class="progress-bar-fill" id="progress-bar-${t}"></div></div><p id="percentage-${t}"></p><p id="speed-${t}"></p></div>`)}});a.forEach(async e=>{let t=await fetch(e.url),m=t.body.getReader(),o=0,c=[],d=0,l=new Date().getTime(),u=+t.headers.get("Content-Length")||+e.dom.getAttribute("content-length");for(;;){let{done:n,value:s}=await m.read();if(n)break;c.push(s),o+=s.length,d=(o/u*100).toFixed(2);let g=new Date().getTime(),b=g-l;l=g;let i=(s.length/b/1024*1e3).toFixed(2);if(i>1024){let h=(i/1024*1e3).toFixed(2);document.getElementById("speed-"+e.url).innerText=`${h} MB/s`}else document.getElementById("speed-"+e.url).innerText=`${i} KB/s`;document.getElementById("progress-bar-"+e.url).style.maxWidth=d+"%",document.getElementById("percentage-"+e.url).innerText=d+"%"}let p=new Blob(c,{type:e.type}),r=document.createElement(e.dom.tagName);for(let n=0;n<e.dom.attributes.length;n++){let s=e.dom.attributes.item(n);r.setAttribute(s.nodeName,s.nodeValue)}console.log(r),r.tagName=="SCRIPT"&&r.setAttribute("src",URL.createObjectURL(p)),r.tagName=="LINK"&&r.getAttribute("rel")=="stylesheet"&&r.setAttribute("href",URL.createObjectURL(p)),e.dom.parentElement.appendChild(r)});})();
