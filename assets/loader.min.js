/**
 * Loading assets with progress bar
 * @author 5dbwat4 <me@5dbwat4.top>
*/(()=>{var a=[];document.querySelector("#app").insertAdjacentHTML("beforeend",`<div class="progressing"></div><style>.progress-bar-rail{position:relative;overflow:hidden;background:rgba(16,11,147,.565);flex:1;height:12px;border-radius:5px}.progress-bar-fill{background:#605ee4;position:relative;border-radius:5px;height:inherit;width:100%;max-width:0;}.loading-item{display:flex;align-items:center}.loading-item p{line-height:0;width:fit-content;color:#5f48e6;padding-right:12px;font-size:12px}.progressing{width:700px;max-width:100%;margin:0 auto;}</style>`);document.querySelectorAll("[progressing]").forEach(e=>{if(e.tagName=="SCRIPT"){let t=e.getAttribute("data-src");a.push({url:t,dom:e,type:"text/javascript"}),document.querySelector(".progressing").insertAdjacentHTML("beforeend",`<div class="loading-item"><p>${t.split("/").pop()}</p><div class="progress-bar-rail"><div class="progress-bar-fill" id="progress-bar-${t}"></div></div><p id="percentage-${t}"></p><p id="speed-${t}"></p></div>`)}if(e.tagName=="LINK"&&e.getAttribute("rel")=="stylesheet"){let t=e.getAttribute("data-href");a.push({url:t,dom:e,type:"text/css"}),document.querySelector(".progressing").insertAdjacentHTML("beforeend",`<div class="loading-item"><p>${t.split("/").pop()}</p><div class="progress-bar-rail"><div class="progress-bar-fill" id="progress-bar-${t}"></div></div><p id="percentage-${t}"></p><p id="speed-${t}"></p></div>`)}});a.forEach(async e=>{let t=await fetch(e.url),m=t.body.getReader(),o=0,l=[],n=0,p=new Date().getTime(),u=+t.headers.get("Content-Length")||+e.dom.getAttribute("content-length");for(;;){let{done:s,value:i}=await m.read();if(s)break;l.push(i),o+=i.length,n=(o/u*100).toFixed(2);let c=new Date().getTime(),b=c-p;p=c;let d=(i.length/b/1024*1e3).toFixed(2);if(d>1024){let h=(d/1024*1e3).toFixed(2);document.getElementById("speed-"+e.url).innerText=`${h} MB/s`}else document.getElementById("speed-"+e.url).innerText=`${d} KB/s`;document.getElementById("progress-bar-"+e.url).style.maxWidth=n+"%",document.getElementById("percentage-"+e.url).innerText=n+"%"}let g=new Blob(l,{type:e.type}),r=document.createElement(e.dom.tagName);for(let s=0;s<e.dom.attributes.length;s++){let i=e.dom.attributes.item(s);r.setAttribute(i.nodeName,i.nodeValue)}console.log(r),r.tagName=="SCRIPT"&&r.setAttribute("src",URL.createObjectURL(g)),r.tagName=="LINK"&&r.getAttribute("rel")=="stylesheet"&&r.setAttribute("href",URL.createObjectURL(g)),e.dom.parentElement.appendChild(r)});})();